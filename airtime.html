<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Category</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h2>Category Page</h2>
  <nav>
    <a href="cart.html">Cart (<span id="cart-count">0</span>)</a>
    <a href="login.html">Login</a>
  </nav>
</header>

<div class="container" id="services"></div>

<script src="products.js"></script>

<script>

/* ===== LOAD PRODUCT FROM SEARCH ===== */
const params=new URLSearchParams(window.location.search);
const productId=params.get("product");

const container=document.getElementById("services");

if(productId){

  let product=allProducts.find(p=>p.id==productId);

  container.innerHTML=`
    <div class="card">
      <img src="${product.image}">
      <h3>${product.title}</h3>
      <p>${product.description}</p>
      <strong>$${product.price}</strong><br>
      <button onclick="addToCart(${product.id})">
        Add To Cart
      </button>
    </div>
  `;

}else{

  allProducts.forEach(p=>{
    container.innerHTML+=`
      <div class="card">
        <img src="${p.image}">
        <h3>${p.title}</h3>
        <p>${p.description}</p>
        <strong>$${p.price}</strong><br>
        <button onclick="addToCart(${p.id})">
          Add To Cart
        </button>
      </div>
    `;
  });

}

/* ===== CART ===== */
function updateCartCount(){
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  document.getElementById("cart-count").innerText =
    cart.reduce((sum,i)=>sum+i.quantity,0);
}
updateCartCount();

function addToCart(id){
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  let product = allProducts.find(p=>p.id===id);

  let existing = cart.find(i=>i.id===id);
  if(existing){ existing.quantity+=1; }
  else{ cart.push({...product, quantity:1}); }

  localStorage.setItem("cart", JSON.stringify(cart));
  updateCartCount();
}

</script>
</body>
</html>
