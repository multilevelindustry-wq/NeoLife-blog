<!DOCTYPE html>
<html>
<head>
  <title>Checkout</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h2>Checkout</h2>
  <nav>
    <a href="cart.html">Back to Cart</a>
  </nav>
</header>

<div style="padding:40px; text-align:center;">
  <h2>Total Amount: $<span id="totalAmount"></span></h2>

  <!-- PayPal Button -->
  <div id="paypal-button-container" style="margin-top:30px;"></div>

  <!-- Paystack Button -->
  <div style="margin-top:20px;">
    <button onclick="payWithPaystack()" 
      style="padding:12px 25px; background:#0ba4db; color:white; border:none; border-radius:5px; cursor:pointer;">
      Pay With Paystack (Auto NGN)
    </button>
  </div>
</div>

<!-- PayPal SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=Aey_vJzSIErk6JUHmkIU41JQ4W1vA2FlfBNf5Vtkg7j4YLaWHkFtw4WSPI0SWiCzhaNKqPt2oGuVIF1n&currency=USD"></script>

<!-- Paystack SDK -->
<script src="https://js.paystack.co/v1/inline.js"></script>


<!-- =======================
     FOOTER
======================= -->

<footer style="background:#111; color:white; padding:30px; margin-top:40px;">
  <div style="display:flex; flex-wrap:wrap; justify-content:space-around;">
    <div>Privacy Policy</div>
    <div>Terms & Conditions</div>
    <div>Blog</div>
    <div>Customer Service</div>
    <div>Refund Policy</div>
    <div>FAQs</div>
    <div>About Us</div>
    <div>Contact Us</div>
  </div>

  <p style="text-align:center; margin-top:20px; font-size:14px;">
    Â© 2026 Your Company Name. All Rights Reserved.
  </p>
</footer>
  
<script>

// ===============================
// LOGIN CHECK
// ===============================
if(!localStorage.getItem("loggedIn")){
  alert("Please login first");
  window.location.href = "login.html";
}

// ===============================
// GET CART
// ===============================
let cart = JSON.parse(localStorage.getItem("cart")) || [];

if(cart.length === 0){
  alert("Your cart is empty.");
  window.location.href = "cart.html";
}

let totalUSD = 0;
cart.forEach(item => {
  totalUSD += item.price * (item.quantity || 1);
});

document.getElementById("totalAmount").innerText = totalUSD.toFixed(2);

// ===============================
// PAYPAL (USD)
// ===============================
if (typeof paypal !== "undefined") {

  paypal.Buttons({

    createOrder: function(data, actions) {
      return actions.order.create({
        purchase_units: [{
          amount: {
            value: totalUSD.toFixed(2)
          }
        }]
      });
    },

    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {

        saveOrder(details.id, totalUSD, "USD");

        alert("PayPal Payment Successful!");
        window.location.href = "dashboard.html";
      });
    }

  }).render('#paypal-button-container');

}

// ===============================
// PAYSTACK (AUTO CONVERT TO NGN)
// ===============================
function payWithPaystack(){

  let currentUser = JSON.parse(localStorage.getItem("currentUser"));
  if(!currentUser){
    alert("Please login first");
    return;
  }

  // ðŸ”¥ Automatic Conversion Rate (You can adjust)
  let exchangeRate = 1400; 
  let totalNGN = totalUSD * exchangeRate;

  let handler = PaystackPop.setup({
    key: 'pk_live_ae2ef39d24e2f001cbc716def10d3ede5148af5b',
    email: currentUser.email,
    amount: Math.round(totalNGN * 100), // kobo
    currency: "NGN",
    ref: 'PS-' + Date.now(),

    callback: function(response){

      saveOrder(response.reference, totalUSD, "NGN");

      alert("Paystack Payment Successful!");
      window.location.href = "dashboard.html";
    },

    onClose: function(){
      alert("Transaction cancelled.");
    }

  });

  handler.openIframe();
}

// ===============================
// SAVE ORDER FUNCTION
// ===============================
function saveOrder(reference, amount, currency){

  let currentUser = JSON.parse(localStorage.getItem("currentUser"));
  let allOrders = JSON.parse(localStorage.getItem("orders")) || [];

  let orderID = "ORD-" + Date.now();

  let order = {
    id: orderID,
    paymentRef: reference,
    userID: currentUser.id,
    userName: currentUser.name,
    userEmail: currentUser.email,
    items: cart,
    totalUSD: totalUSD,
    currencyPaid: currency,
    date: new Date().toLocaleString()
  };

  allOrders.push(order);
  localStorage.setItem("orders", JSON.stringify(allOrders));

  localStorage.removeItem("cart");
}

</script>

</body>
</html>
