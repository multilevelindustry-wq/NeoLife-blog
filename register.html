<!DOCTYPE html>
<html>
<head>
  <title>Register</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div style="padding:40px;">
  <h2>Create Account</h2>
  <input type="text" id="name" placeholder="Full Name">
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="register()">Register</button><br><br>
  if already registered <br>
   <a href="login.html"><button >Login</button></a>
</div>

<input type="hidden" id="referrerId" name="referrerId">

<script>
    
   // Generate Unique Affiliate ID
function generateAffiliateID(){
  return "AFF" + Date.now();
}

function register(){

  let nameValue = document.getElementById("name").value.trim();
  let emailValue = document.getElementById("email").value.trim();
  let passwordValue = document.getElementById("password").value.trim();

  if(!nameValue || !emailValue || !passwordValue){
    alert("All fields are required!");
    return;
  }

  // Get existing users
  let users = JSON.parse(localStorage.getItem("users")) || [];

  // Check if email already exists
  let emailExists = users.find(u => u.email === emailValue);
  if(emailExists){
    alert("Email already registered!");
    return;
  }

  // Get sponsor ID from URL
  let sponsorID = new URLSearchParams(window.location.search).get("ref");

  let newUser = {
    id: generateAffiliateID(),
    name: nameValue,
    email: emailValue,
    password: passwordValue,
    sponsorID: sponsorID || null,
    personalPV: 0,
    teamPV: 0,
    totalEarnings: 0,
    withdrawable: 0,
    level: "Starter",
    downlines: []
  };

  // Add user to array
  users.push(newUser);

  // Update sponsor downlines if sponsor exists
  if(sponsorID){
    let sponsor = users.find(u => u.id === sponsorID);
    if(sponsor){
      sponsor.downlines.push(newUser.id);
    }
  }

  // Save back to localStorage
  localStorage.setItem("users", JSON.stringify(users));

  alert("Registered Successfully!");
  window.location.href = "login.html";
}


</script>

</body>
</html>