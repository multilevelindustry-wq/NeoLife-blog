<!DOCTYPE html>
<html>
<head>
<title>Admin Affiliate Panel</title>
</head>
<body>

<h2>All Affiliates</h2>
<div id="allAffiliates"></div>

<script>
const container = document.getElementById("allAffiliates");

for(let key in localStorage){
    if(key.startsWith("user_")){
        const user = JSON.parse(localStorage.getItem(key));

        const div = document.createElement("div");
        div.style.border="1px solid #ccc";
        div.style.margin="10px";
        div.style.padding="10px";

        div.innerHTML = `
        <b>${user.name}</b><br>
        Email: ${user.email}<br>
        PV: ${user.pv}<br>
        Earnings: $${user.earnings}<br>
        Team Size: ${user.team.length}
        `;

        container.appendChild(div);
    }
}

 const container = document.getElementById("allAffiliates");

for(let key in localStorage){

    if(key.startsWith("user_")){

        const user = JSON.parse(localStorage.getItem(key));

        const div = document.createElement("div");
        div.style.border="1px solid #ccc";
        div.style.margin="10px";
        div.style.padding="10px";

        div.innerHTML = `
        <b>${user.name}</b><br>
        Email: ${user.email}<br>
        Affiliate ID: ${user.affiliateID}<br>
        PV: $${(user.pv || 0).toFixed(2)}<br>
        Earnings: $${(user.earnings || 0).toFixed(2)}<br>
        Team Size: ${user.team ? user.team.length : 0}
        `;

        container.appendChild(div);
    }
}


// ===============================
// SHOW WITHDRAWAL REQUESTS
// ===============================
let withdrawals = JSON.parse(localStorage.getItem("withdrawals")) || [];

const withdrawDiv = document.createElement("div");
withdrawDiv.innerHTML = "<h2>Withdrawal Requests</h2>";

withdrawals.forEach((w, index) => {

    const box = document.createElement("div");
    box.style.border="1px solid red";
    box.style.padding="10px";
    box.style.margin="10px";

    box.innerHTML = `
        Affiliate ID: ${w.affiliateID}<br>
        Email: ${w.email}<br>
        Amount: $${w.amount}<br>
        Status: ${w.status}<br>
        <button onclick="approveWithdrawal(${index})">Approve</button>
    `;

    withdrawDiv.appendChild(box);
});

container.appendChild(withdrawDiv);


// ===============================
// APPROVE WITHDRAWAL
// ===============================
function approveWithdrawal(index){

    let withdrawals = JSON.parse(localStorage.getItem("withdrawals")) || [];
    let request = withdrawals[index];

    for(let key in localStorage){

        if(key.startsWith("user_")){

            let user = JSON.parse(localStorage.getItem(key));

            if(user.affiliateID === request.affiliateID){

                user.earnings = 0;
                localStorage.setItem(key, JSON.stringify(user));
            }
        }
    }

    withdrawals[index].status = "approved";
    localStorage.setItem("withdrawals", JSON.stringify(withdrawals));

    alert("Withdrawal Approved & Earnings Cleared.");
    location.reload();
}
</script>

</body>
</html>
